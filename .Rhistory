# Add box plot (using geom_boxplot)
geom_boxplot(width = 0.6, outlier.alpha = 0.5) +
# Add mean age points (white diamond) for clarity
stat_summary(fun = mean, geom = "point", shape = 23, size = 3, fill = "white", color = "black") +
# Customize Labels and Titles
labs(
title = "Distribution of Starting XI Age by Match Result (All Teams)",
subtitle = "Analysis across the entire league shows a flat distribution, indicating no correlation between age and outcome.",
x = "Match Result (Ordered by Mean Age)",
y = "Average Starting XI Age (Years)",
fill = "Result"
) +
# Customize the theme
theme_minimal() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "none" # Hide redundant legend
) +
# Set consistent scale for easier comparison
coord_cartesian(ylim = c(20, 31))
# Display and Save the plot
print(league_boxplot)
ggsave("avg_age_by_result_all_teams_boxplot.png", plot = league_boxplot, width = 8, height = 6)
# =========================================================================
# --- 4. VISUALIZATION 2: AIK COACH COMPARISON (Combined Trend) ---
# Shows the age trend split by coach period (supporting Insight 1).
# =========================================================================
# Calculate the overall mean for horizontal lines
aik_age_summary <- aik_data %>%
group_by(period) %>%
summarise(
Mean_Age = mean(avg_age, na.rm = TRUE)
)
aik_trend_combined <- aik_data %>%
ggplot(aes(x = match_date, y = avg_age, color = period)) +
# 1. Add Shading for Off-Season
geom_rect(
xmin = off_season_start,
xmax = off_season_end,
ymin = -Inf, ymax = Inf,
fill = "grey",
alpha = 0.1,
inherit.aes = FALSE
) +
# 2. Add points for individual matches
geom_point(alpha = 0.7, size = 3) +
# 3. Add a smoothed trend line
geom_smooth(method = "loess", se = FALSE, linewidth = 1.2) +
# 4. Add a horizontal line for the overall mean of each period
geom_hline(
data = aik_age_summary,
aes(yintercept = Mean_Age, color = period),
linetype = "dashed",
linewidth = 0.8
) +
# 5. X-Axis Labels: Show abbreviated Month and Year
scale_x_date(
date_breaks = "3 months",
date_labels = "%b %Y"
) +
# 6. Customize Labels and Titles
labs(
title = "AIK Average Starting XI Age Trend by Coaching Period",
subtitle = "New coach maintains a slightly higher mean age, prioritizing experienced players.",
x = "Match Date",
y = "Average Starting XI Age (Years)",
color = "Coach Period"
) +
# 7. Customize the theme for better readability
theme_minimal() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "bottom",
axis.text.x = element_text(angle = 45, hjust = 1)
)
# Display and Save the plot
print(aik_trend_combined)
ggsave("avg_age_starting_XI_trend_with_offseason.png", plot = aik_trend_combined, width = 10, height = 6)
# =========================================================================
# --- 5. VISUALIZATION 3: AIK NEW COACH INTERNAL TREND (LM) ---
# Uses Linear Model (LM) to confirm the near-flat slope under the new coach.
# =========================================================================
# Filter the data to include ONLY the 'After Coach' period
new_coach_df <- aik_data %>%
filter(period == "After Coach")
# Calculate the mean age for the new coach's period
new_coach_mean <- mean(new_coach_df$avg_age, na.rm = TRUE)
aik_trend_internal <- new_coach_df %>%
ggplot(aes(x = match_date, y = avg_age)) +
# 1. Add Shading for Off-Season
geom_rect(
xmin = off_season_start,
xmax = off_season_end,
ymin = -Inf, ymax = Inf,
fill = "grey",
alpha = 0.1,
inherit.aes = FALSE
) +
# 2. Add points for individual matches
geom_point(size = 3, color = "#1b9e77") +
# 3. Add a Linear Regression (LM) line to show the overall trend slope
geom_smooth(method = "lm", se = TRUE, color = "darkred", linewidth = 1.2) +
# 4. Add a horizontal line for the new coach's overall mean
geom_hline(
yintercept = new_coach_mean,
linetype = "dashed",
color = "black",
linewidth = 0.8
) +
# 5. X-Axis Labels: Show abbreviated Month and Year
scale_x_date(
date_breaks = "3 months",
date_labels = "%b %Y"
) +
# 6. Customize Labels and Titles
labs(
title = "Internal Trend: Average Starting XI Age Under the New Coach",
subtitle = paste("Mean Age: ", round(new_coach_mean, 2), " years. Flat trend (red line) indicates a stable core selection."),
x = "Match Date",
y = "Average Starting XI Age (Years)"
) +
# 7. Customize the theme
theme_minimal() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust = 1)
)
# Display and Save the plot
print(aik_trend_internal)
ggsave("new_coach_internal_trend.png", plot = aik_trend_internal, width = 10, height = 6)
# =========================================================================
# FILE: visualization_script.R
# DESCRIPTION: R script for analysis and visualization based on the two
# SQL views exported as CSVs:
# 1. aik_performance_by_period.csv (AIK-specific data)
# 2. allsvenskan_team_match_data.csv (League-wide data)
#
# Libraries required: tidyverse (ggplot2, dplyr) for data manipulation and plotting.
# =========================================================================
# --- 1. SETUP AND DATA LOADING ---
# Ensure you have the 'tidyverse' package installed: install.packages("tidyverse")
library(tidyverse)
library(lubridate) # For date manipulation
# IMPORTANT: R Working Directory Note
# The script is designed to be run from the PROJECT ROOT (the folder containing the 'Data' folder).
# If you are running this script inside RStudio, make sure your working directory is set to the project root:
# Session -> Set Working Directory -> To Project Directory
# Set the path where your extracted CSV files are located (relative to your R working directory)
DATA_PATH <- "Data/"
# Load data from the two SQL views exported as CSVs
# NOTE: Renamed AIK data to match the SQL view output
aik_data <- read_csv(file.path(DATA_PATH, "aik_performance_by_period.csv")) %>%
mutate(match_date = as_date(match_date))
# NOTE: Renamed League data to match the SQL view output
league_data <- read_csv(file.path(DATA_PATH, "allsvenskan_team_match_data.csv")) %>%
mutate(match_date = as_date(match_date))
# Clean column names to be R-friendly (replace quotes and convert to snake_case)
# This step is largely redundant if the CSVs are directly from the views, but kept for robustness.
names(aik_data) <- tolower(names(aik_data))
names(league_data) <- tolower(names(league_data))
# --- 2. DATA CLEANING AND PREPARATION ---
# Calculate goals difference and match result for league-wide data (REQUIRED FOR BOX PLOT)
league_data <- league_data %>%
mutate(
goals_diff = goals_for - goals_against,
match_result = case_when(
goals_diff > 0 ~ "Win",
goals_diff < 0 ~ "Loss",
TRUE ~ "Draw"
)
)
# Define the off-season period (used for AIK plots)
off_season_start <- as_date("2024-11-25")
off_season_end <- as_date("2025-03-25")
# =========================================================================
# --- 3. VISUALIZATION 1: LEAGUE-WIDE AGE VS. RESULT (BOX PLOT) ---
# Confirms age provides no statistical edge league-wide (supporting Insight 2).
# =========================================================================
# Calculate mean age and order results (for clean ordering in the plot)
result_age_stats <- league_data %>%
group_by(match_result) %>%
summarise(
Mean_Age = mean(avg_age, na.rm = TRUE)
) %>%
arrange(desc(Mean_Age))
# Define the order for the plot based on the calculated means
result_order <- result_age_stats$match_result
league_boxplot <- league_data %>%
ggplot(aes(x = factor(match_result, level = result_order), y = avg_age, fill = match_result)) +
# Add box plot (using geom_boxplot)
geom_boxplot(width = 0.6, outlier.alpha = 0.5) +
# Add mean age points (white diamond) for clarity
stat_summary(fun = mean, geom = "point", shape = 23, size = 3, fill = "white", color = "black") +
# Customize Labels and Titles
labs(
title = "Distribution of Starting XI Age by Match Result (All Teams)",
subtitle = "Analysis across the entire league shows a flat distribution, indicating no correlation between age and outcome.",
x = "Match Result (Ordered by Mean Age)",
y = "Average Starting XI Age (Years)",
fill = "Result"
) +
# Customize the theme
theme_minimal() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "none" # Hide redundant legend
) +
# Set consistent scale for easier comparison
coord_cartesian(ylim = c(20, 31))
# Display and Save the plot
print(league_boxplot)
ggsave("avg_age_by_result_all_teams_boxplot.png", plot = league_boxplot, width = 8, height = 6)
# =========================================================================
# --- 4. VISUALIZATION 2: AIK COACH COMPARISON (Combined Trend) ---
# Shows the age trend split by coach period (supporting Insight 1).
# =========================================================================
# Calculate the overall mean for horizontal lines
aik_age_summary <- aik_data %>%
group_by(period) %>%
summarise(
Mean_Age = mean(avg_age, na.rm = TRUE)
)
aik_trend_combined <- aik_data %>%
ggplot(aes(x = match_date, y = avg_age, color = period)) +
# 1. Add Shading for Off-Season
geom_rect(
xmin = off_season_start,
xmax = off_season_end,
ymin = -Inf, ymax = Inf,
fill = "grey",
alpha = 0.1,
inherit.aes = FALSE
) +
# 2. Add points for individual matches
geom_point(alpha = 0.7, size = 3) +
# 3. Add a smoothed trend line
geom_smooth(method = "loess", se = FALSE, linewidth = 1.2) +
# 4. Add a horizontal line for the overall mean of each period
geom_hline(
data = aik_age_summary,
aes(yintercept = Mean_Age, color = period),
linetype = "dashed",
linewidth = 0.8
) +
# 5. X-Axis Labels: Show abbreviated Month and Year
scale_x_date(
date_breaks = "3 months",
date_labels = "%b %Y"
) +
# 6. Customize Labels and Titles
labs(
title = "AIK Average Starting XI Age Trend by Coaching Period",
subtitle = "New coach maintains a slightly higher mean age, prioritizing experienced players.",
x = "Match Date",
y = "Average Starting XI Age (Years)",
color = "Coach Period"
) +
# 7. Customize the theme for better readability
theme_minimal() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "bottom",
axis.text.x = element_text(angle = 45, hjust = 1)
)
# Display and Save the plot
print(aik_trend_combined)
ggsave("avg_age_starting_XI_trend_with_offseason.png", plot = aik_trend_combined, width = 10, height = 6)
# =========================================================================
# --- 5. VISUALIZATION 3: AIK NEW COACH INTERNAL TREND (LM) ---
# Uses Linear Model (LM) to confirm the near-flat slope under the new coach.
# =========================================================================
# Filter the data to include ONLY the 'After Coach' period
new_coach_df <- aik_data %>%
filter(period == "After Coach")
# Calculate the mean age for the new coach's period
new_coach_mean <- mean(new_coach_df$avg_age, na.rm = TRUE)
aik_trend_internal <- new_coach_df %>%
ggplot(aes(x = match_date, y = avg_age)) +
# 1. Add Shading for Off-Season
geom_rect(
xmin = off_season_start,
xmax = off_season_end,
ymin = -Inf, ymax = Inf,
fill = "grey",
alpha = 0.1,
inherit.aes = FALSE
) +
# 2. Add points for individual matches
geom_point(size = 3, color = "#1b9e77") +
# 3. Add a Linear Regression (LM) line to show the overall trend slope
geom_smooth(method = "lm", se = TRUE, color = "darkred", linewidth = 1.2) +
# 4. Add a horizontal line for the new coach's overall mean
geom_hline(
yintercept = new_coach_mean,
linetype = "dashed",
color = "black",
linewidth = 0.8
) +
# 5. X-Axis Labels: Show abbreviated Month and Year
scale_x_date(
date_breaks = "3 months",
date_labels = "%b %Y"
) +
# 6. Customize Labels and Titles
labs(
title = "Internal Trend: Average Starting XI Age Under the New Coach",
subtitle = paste("Mean Age: ", round(new_coach_mean, 2), " years. Flat trend (red line) indicates a stable core selection."),
x = "Match Date",
y = "Average Starting XI Age (Years)"
) +
# 7. Customize the theme
theme_minimal() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust = 1)
)
# Display and Save the plot
print(aik_trend_internal)
ggsave("new_coach_internal_trend.png", plot = aik_trend_internal, width = 10, height = 6)
# =========================================================================
# FILE: visualization_script.R
# DESCRIPTION: R script for analysis and visualization based on the two
# SQL views exported as CSVs. Outputs are saved to the 'Visualizations' folder.
#
# Libraries required: tidyverse (ggplot2, dplyr) for data manipulation and plotting.
# =========================================================================
# --- 1. SETUP AND DATA LOADING ---
# Ensure you have the 'tidyverse' package installed: install.packages("tidyverse")
library(tidyverse)
library(lubridate) # For date manipulation
# Set the path where your extracted CSV files are located (relative to your R working directory)
DATA_PATH <- "Data/"
# Define the output directory for visualizations
OUTPUT_DIR <- "Visualizations"
# Create the output directory if it doesn't exist
if (!dir.exists(OUTPUT_DIR)) {
dir.create(OUTPUT_DIR, recursive = TRUE)
message(paste("Created output directory:", OUTPUT_DIR))
}
# Load data from the two SQL views exported as CSVs
aik_data <- read_csv(file.path(DATA_PATH, "aik_performance_by_period.csv")) %>%
mutate(match_date = as_date(match_date))
league_data <- read_csv(file.path(DATA_PATH, "allsvenskan_team_match_data.csv")) %>%
mutate(match_date = as_date(match_date))
# Clean column names to be R-friendly
names(aik_data) <- tolower(names(aik_data))
names(league_data) <- tolower(names(league_data))
# --- 2. DATA CLEANING AND PREPARATION ---
# Calculate goals difference and match result for league-wide data (REQUIRED FOR BOX PLOT)
league_data <- league_data %>%
mutate(
goals_diff = goals_for - goals_against,
match_result = case_when(
goals_diff > 0 ~ "Win",
goals_diff < 0 ~ "Loss",
TRUE ~ "Draw"
)
)
# Define the off-season period (used for AIK plots)
off_season_start <- as_date("2024-11-25")
off_season_end <- as_date("2025-03-25")
# =========================================================================
# --- 3. VISUALIZATION 1: LEAGUE-WIDE AGE VS. RESULT (BOX PLOT) ---
# =========================================================================
# Calculate mean age and order results (for clean ordering in the plot)
result_age_stats <- league_data %>%
group_by(match_result) %>%
summarise(
Mean_Age = mean(avg_age, na.rm = TRUE)
) %>%
arrange(desc(Mean_Age))
# Define the order for the plot based on the calculated means
result_order <- result_age_stats$match_result
league_boxplot <- league_data %>%
ggplot(aes(x = factor(match_result, level = result_order), y = avg_age, fill = match_result)) +
# Add box plot (using geom_boxplot)
geom_boxplot(width = 0.6, outlier.alpha = 0.5) +
# Add mean age points (white diamond) for clarity
stat_summary(fun = mean, geom = "point", shape = 23, size = 3, fill = "white", color = "black") +
# Customize Labels and Titles
labs(
title = "Distribution of Starting XI Age by Match Result (All Teams)",
subtitle = "Analysis across the entire league shows a flat distribution, indicating no correlation between age and outcome.",
x = "Match Result (Ordered by Mean Age)",
y = "Average Starting XI Age (Years)",
fill = "Result"
) +
# Customize the theme
theme_minimal() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "none" # Hide redundant legend
) +
# Set consistent scale for easier comparison
coord_cartesian(ylim = c(20, 31))
# Display and Save the plot to the Visualizations folder
print(league_boxplot)
ggsave(file.path(OUTPUT_DIR, "avg_age_by_result_all_teams_boxplot.png"), plot = league_boxplot, width = 8, height = 6)
# =========================================================================
# --- 4. VISUALIZATION 2: AIK COACH COMPARISON (Combined Trend) ---
# =========================================================================
# Calculate the overall mean for horizontal lines
aik_age_summary <- aik_data %>%
group_by(period) %>%
summarise(
Mean_Age = mean(avg_age, na.rm = TRUE)
)
aik_trend_combined <- aik_data %>%
ggplot(aes(x = match_date, y = avg_age, color = period)) +
# 1. Add Shading for Off-Season
geom_rect(
xmin = off_season_start,
xmax = off_season_end,
ymin = -Inf, ymax = Inf,
fill = "grey",
alpha = 0.1,
inherit.aes = FALSE
) +
# 2. Add points for individual matches
geom_point(alpha = 0.7, size = 3) +
# 3. Add a smoothed trend line
geom_smooth(method = "loess", se = FALSE, linewidth = 1.2) +
# 4. Add a horizontal line for the overall mean of each period
geom_hline(
data = aik_age_summary,
aes(yintercept = Mean_Age, color = period),
linetype = "dashed",
linewidth = 0.8
) +
# 5. X-Axis Labels: Show abbreviated Month and Year
scale_x_date(
date_breaks = "3 months",
date_labels = "%b %Y"
) +
# 6. Customize Labels and Titles
labs(
title = "AIK Average Starting XI Age Trend by Coaching Period",
subtitle = "New coach maintains a slightly higher mean age, prioritizing experienced players.",
x = "Match Date",
y = "Average Starting XI Age (Years)",
color = "Coach Period"
) +
# 7. Customize the theme for better readability
theme_minimal() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "bottom",
axis.text.x = element_text(angle = 45, hjust = 1)
)
# Display and Save the plot to the Visualizations folder
print(aik_trend_combined)
ggsave(file.path(OUTPUT_DIR, "avg_age_starting_XI_trend_with_offseason.png"), plot = aik_trend_combined, width = 10, height = 6)
# =========================================================================
# --- 5. VISUALIZATION 3: AIK NEW COACH INTERNAL TREND (LM) ---
# =========================================================================
# Filter the data to include ONLY the 'After Coach' period
new_coach_df <- aik_data %>%
filter(period == "After Coach")
# Calculate the mean age for the new coach's period
new_coach_mean <- mean(new_coach_df$avg_age, na.rm = TRUE)
aik_trend_internal <- new_coach_df %>%
ggplot(aes(x = match_date, y = avg_age)) +
# 1. Add Shading for Off-Season
geom_rect(
xmin = off_season_start,
xmax = off_season_end,
ymin = -Inf, ymax = Inf,
fill = "grey",
alpha = 0.1,
inherit.aes = FALSE
) +
# 2. Add points for individual matches
geom_point(size = 3, color = "#1b9e77") +
# 3. Add a Linear Regression (LM) line to show the overall trend slope
geom_smooth(method = "lm", se = TRUE, color = "darkred", linewidth = 1.2) +
# 4. Add a horizontal line for the new coach's overall mean
geom_hline(
yintercept = new_coach_mean,
linetype = "dashed",
color = "black",
linewidth = 0.8
) +
# 5. X-Axis Labels: Show abbreviated Month and Year
scale_x_date(
date_breaks = "3 months",
date_labels = "%b %Y"
) +
# 6. Customize Labels and Titles
labs(
title = "Internal Trend: Average Starting XI Age Under the New Coach",
subtitle = paste("Mean Age: ", round(new_coach_mean, 2), " years. Flat trend (red line) indicates a stable core selection."),
x = "Match Date",
y = "Average Starting XI Age (Years)"
) +
# 7. Customize the theme
theme_minimal() +
theme(
plot.title = element_text(face = "bold", hjust = 0.5),
plot.subtitle = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust = 1)
)
# Display and Save the plot to the Visualizations folder
print(aik_trend_internal)
ggsave(file.path(OUTPUT_DIR, "new_coach_internal_trend.png"), plot = aik_trend_internal, width = 10, height = 6)
